import{_ as l,o as r,c as m,d as o,t as d,F as _,r as f,a as v,n as g,b as y,U as B,w as p,v as T,M as h,h as $,i as M}from"./index-Y2JP5UBy.js";const b={props:["test"],computed:{formattedTimeStamp(){const e=new Date(this.test.timestamp),s=e.toLocaleDateString("en-US",{month:"numeric",day:"numeric",year:"numeric"}),a=e.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0});return`${s} ${a}`}},methods:{goToTest(){this.$router.push({name:"tests",params:{id:this.test.patientID,testId:this.test.id}})}}};function k(e,s,a,u,i,t){return r(),m("div",{class:"main",onClick:s[0]||(s[0]=c=>t.goToTest())},[o("h2",null,d(a.test.name),1),o("h3",null,d(t.formattedTimeStamp),1)])}const S=l(b,[["render",k],["__scopeId","data-v-719b4321"]]),I={props:{tests:Array,shrink:{type:Boolean,default:!1},activeTest:Object},components:{TestCard:S},methods:{goToTest(e){this.$router.push({name:"tests",params:{id:e.patientID,testId:e.id}})}}};function D(e,s,a,u,i,t){const c=y("TestCard");return r(),m("div",{class:g({"test-container":!0,shrink:a.shrink,nav:!0})},[(r(!0),m(_,null,f(a.tests,n=>(r(),v(c,{key:n.id,test:n,class:g({shrink:a.shrink,"active-test":a.activeTest===n})},null,8,["test","class"]))),128))],2)}const E=l(I,[["render",D],["__scopeId","data-v-411631d3"]]),C={props:["message"],data(){return{name:""}},methods:{formatDate(e){return new Date(e).toLocaleString("en-US",{month:"2-digit",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})},isFrom(){return this.message.fromUsername===this.$store.state.user.username}},created(){B.getName(this.message.fromUsername,this.$store.state.token).then(e=>{this.name=e.data})}},w={class:"body"},U={class:"timestamp"};function x(e,s,a,u,i,t){return r(),m("div",{class:g({from:t.isFrom(),to:!t.isFrom(),"message-bubble":!0})},[p(o("span",{class:"username"},d(i.name),513),[[T,!t.isFrom()]]),o("span",w,d(a.message.body),1),o("span",U,d(t.formatDate(a.message.timestamp)),1)],2)}const F=l(C,[["render",x],["__scopeId","data-v-90385bd6"]]),L={data(){return{message:{},messageBody:"",messages:[]}},props:{patient:{type:Boolean},test:{type:Boolean},medication:{type:Boolean}},components:{MessageBubble:F},computed:{sortedMessages(){return this.messages.slice().sort((e,s)=>new Date(e.timestamp)-new Date(s.timestamp))},noMessages(){return this.messages.length===0}},methods:{sendMessage(){this.message={body:this.messageBody,patientId:this.$route.params.id,timestamp:new Date,fromUsername:this.$store.state.user.username,toUsername:"cakelly4",testId:null,prescriptionId:null},this.test&&(this.message.testId=this.$route.params.testId),h.sendMessage(this.message,this.$store.state.token).then(e=>{this.updateMessages(),this.messageBody="",this.scrollToBottom()}).catch(e=>{console.log(e)})},updateMessages(){this.patient?h.getMessagesByPatient(this.$route.params.id,this.$store.state.token).then(e=>{this.messages=e.data,this.scrollToBottom()}):this.test&&h.getMessagesByTest(this.$route.params.id,this.$route.params.testId,this.$store.state.token).then(e=>{this.messages=e.data,this.scrollToBottom()})},scrollToBottom(){const e=this.$refs.messagesContainer;e.scrollTop=e.clientHeight}},created(){this.updateMessages()},updated(){this.scrollToBottom()},watch:{$route(e,s){this.updateMessages()}}},N={class:"conversation"},V={class:"messages",ref:"messagesContainer"},j={class:"send"};function z(e,s,a,u,i,t){const c=y("MessageBubble");return r(),m("div",N,[o("div",V,[(r(!0),m(_,null,f(t.sortedMessages,n=>(r(),v(c,{key:n.id,message:n},null,8,["message"]))),128)),p(o("span",null,"Send a message to start a conversation...",512),[[T,t.noMessages]])],512),o("form",j,[p(o("textarea",{class:"box",placeholder:"Type a message...","onUpdate:modelValue":s[0]||(s[0]=n=>i.messageBody=n)},null,512),[[$,i.messageBody]]),o("input",{type:"submit",value:"send",onClick:s[1]||(s[1]=M((...n)=>t.sendMessage&&t.sendMessage(...n),["prevent"]))})])])}const H=l(L,[["render",z],["__scopeId","data-v-9059db3f"]]);export{H as C,E as T};
